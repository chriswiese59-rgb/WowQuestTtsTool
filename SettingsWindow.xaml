<Window x:Class="WowQuestTtsTool.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Einstellungen"
        Width="650"
        Height="700"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResize">
    <Grid Margin="15">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- TabControl für verschiedene Einstellungen -->
        <TabControl Grid.Row="0">
            <!-- TTS-Engines Tab (NEU) -->
            <TabItem Header="TTS-Engines">
                <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="10">
                    <StackPanel>
                        <TextBlock Text="TTS-Engines Konfiguration"
                                   FontSize="16" FontWeight="Bold" Margin="0,0,0,15"/>

                        <!-- Standard-Engine Auswahl -->
                        <StackPanel Margin="0,0,0,15">
                            <TextBlock Text="Standard-Engine:" FontWeight="SemiBold" Margin="0,0,0,5"/>
                            <ComboBox x:Name="DefaultEngineCombo" Height="28"
                                      SelectionChanged="DefaultEngineCombo_SelectionChanged">
                                <ComboBoxItem Content="ElevenLabs (External)" Tag="External"/>
                                <ComboBoxItem Content="OpenAI TTS" Tag="OpenAI"/>
                                <ComboBoxItem Content="Google Cloud TTS" Tag="Gemini"/>
                                <ComboBoxItem Content="Claude Audio (nicht verfuegbar)" Tag="Claude" IsEnabled="False"/>
                            </ComboBox>
                        </StackPanel>

                        <!-- OpenAI TTS Einstellungen -->
                        <GroupBox Header="OpenAI TTS" Padding="10" Margin="0,0,0,12">
                            <StackPanel>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <!-- API Key -->
                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="API-Key:" VerticalAlignment="Center" Margin="0,0,10,8"/>
                                    <PasswordBox x:Name="OpenAiApiKeyBox" Grid.Row="0" Grid.Column="1" Height="28" Padding="8,5" Margin="0,0,0,8"
                                                 PasswordChanged="OpenAiApiKeyBox_PasswordChanged"/>
                                    <Button Grid.Row="0" Grid.Column="2" Content="Zeigen" Width="60" Margin="5,0,0,8"
                                            Click="ToggleOpenAiApiKeyVisibility"/>

                                    <!-- Model -->
                                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Modell:" VerticalAlignment="Center" Margin="0,0,10,8"/>
                                    <ComboBox x:Name="OpenAiModelCombo" Grid.Row="1" Grid.Column="1" Height="28" Margin="0,0,0,8"
                                              Grid.ColumnSpan="2">
                                        <ComboBoxItem Content="tts-1 (Standard)" Tag="tts-1"/>
                                        <ComboBoxItem Content="tts-1-hd (Hochqualitaet)" Tag="tts-1-hd"/>
                                    </ComboBox>

                                    <!-- Male Voice -->
                                    <TextBlock Grid.Row="2" Grid.Column="0" Text="Maennl. Stimme:" VerticalAlignment="Center" Margin="0,0,10,8"/>
                                    <ComboBox x:Name="OpenAiMaleVoiceCombo" Grid.Row="2" Grid.Column="1" Height="28" Margin="0,0,0,8"
                                              Grid.ColumnSpan="2">
                                        <ComboBoxItem Content="onyx (tief, maennlich)" Tag="onyx"/>
                                        <ComboBoxItem Content="echo (maennlich)" Tag="echo"/>
                                        <ComboBoxItem Content="alloy (neutral)" Tag="alloy"/>
                                        <ComboBoxItem Content="fable (neutral)" Tag="fable"/>
                                    </ComboBox>

                                    <!-- Female Voice -->
                                    <TextBlock Grid.Row="3" Grid.Column="0" Text="Weibl. Stimme:" VerticalAlignment="Center" Margin="0,0,10,8"/>
                                    <ComboBox x:Name="OpenAiFemaleVoiceCombo" Grid.Row="3" Grid.Column="1" Height="28" Margin="0,0,0,8"
                                              Grid.ColumnSpan="2">
                                        <ComboBoxItem Content="nova (weiblich)" Tag="nova"/>
                                        <ComboBoxItem Content="shimmer (weiblich)" Tag="shimmer"/>
                                        <ComboBoxItem Content="alloy (neutral)" Tag="alloy"/>
                                        <ComboBoxItem Content="fable (neutral)" Tag="fable"/>
                                    </ComboBox>

                                    <!-- Speed -->
                                    <TextBlock Grid.Row="4" Grid.Column="0" Text="Geschwindigkeit:" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                    <StackPanel Grid.Row="4" Grid.Column="1" Orientation="Horizontal" Grid.ColumnSpan="2">
                                        <Slider x:Name="OpenAiSpeedSlider" Width="150" Minimum="0.25" Maximum="4.0"
                                                Value="1.0" TickFrequency="0.25" IsSnapToTickEnabled="True"/>
                                        <TextBlock Text="{Binding ElementName=OpenAiSpeedSlider, Path=Value, StringFormat={}{0:F2}}"
                                                   Margin="10,0,0,0" Width="35" VerticalAlignment="Center"/>
                                    </StackPanel>
                                </Grid>

                                <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                                    <Button Content="Test TTS" Width="80" Height="28" Click="TestOpenAiTts_Click"/>
                                    <TextBlock x:Name="OpenAiStatusText" Text="" VerticalAlignment="Center" Margin="10,0,0,0"
                                               Foreground="Gray"/>
                                </StackPanel>
                            </StackPanel>
                        </GroupBox>

                        <!-- Google Cloud TTS -->
                        <GroupBox Header="Google Cloud TTS" Padding="10" Margin="0,0,0,12">
                            <StackPanel>
                                <Border Background="#E8F5E9" BorderBrush="#81C784" BorderThickness="1"
                                        CornerRadius="4" Padding="10" Margin="0,0,0,10">
                                    <TextBlock TextWrapping="Wrap" FontSize="12">
                                        Google Cloud Text-to-Speech bietet hochwertige Stimmen.
                                        Du kannst entweder einen API-Key oder eine Service Account JSON-Datei verwenden.
                                    </TextBlock>
                                </Border>

                                <!-- API-Key Authentifizierung -->
                                <Grid Margin="0,0,0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="130"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="API-Key:" VerticalAlignment="Center"/>
                                    <PasswordBox x:Name="GoogleApiKeyBox" Grid.Column="1" Height="28" Padding="8,5"
                                                 PasswordChanged="GoogleApiKeyBox_PasswordChanged"
                                                 ToolTip="Google Cloud API-Key (Alternative zu Service Account)"/>
                                    <Button Grid.Column="2" Content="Anzeigen" Width="65" Margin="5,0,0,0"
                                            Click="ToggleGoogleApiKeyVisibility"/>
                                </Grid>

                                <!-- Service Account JSON -->
                                <Grid Margin="0,0,0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="130"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="Service Account:" VerticalAlignment="Center"/>
                                    <TextBox x:Name="GoogleServiceAccountPathBox" Grid.Column="1" Height="28"
                                             Padding="8,5" IsReadOnly="True"
                                             ToolTip="Pfad zur Service Account JSON-Datei"/>
                                    <Button Grid.Column="2" Content="Waehlen..." Width="80" Margin="5,0,0,0"
                                            Click="SelectGoogleServiceAccount"/>
                                </Grid>

                                <!-- Voice-Konfiguration -->
                                <Grid Margin="0,8,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="130"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="130"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Sprache:" VerticalAlignment="Center"/>
                                    <ComboBox x:Name="GoogleLanguageCombo" Grid.Row="0" Grid.Column="1" Height="28"
                                              SelectedIndex="0" Margin="0,0,10,0">
                                        <ComboBoxItem Content="Deutsch (DE)" Tag="de-DE"/>
                                        <ComboBoxItem Content="English (US)" Tag="en-US"/>
                                        <ComboBoxItem Content="English (GB)" Tag="en-GB"/>
                                        <ComboBoxItem Content="Francais" Tag="fr-FR"/>
                                        <ComboBoxItem Content="Espanol" Tag="es-ES"/>
                                    </ComboBox>

                                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Maennl. Stimme:"
                                               VerticalAlignment="Center" Margin="0,8,0,0"/>
                                    <TextBox x:Name="GoogleMaleVoiceBox" Grid.Row="1" Grid.Column="1" Height="28"
                                             Padding="8,5" Margin="0,8,10,0" Text="de-DE-Neural2-B"
                                             ToolTip="z.B. de-DE-Neural2-B, de-DE-Wavenet-B"/>

                                    <TextBlock Grid.Row="1" Grid.Column="2" Text="Weibl. Stimme:"
                                               VerticalAlignment="Center" Margin="0,8,0,0"/>
                                    <TextBox x:Name="GoogleFemaleVoiceBox" Grid.Row="1" Grid.Column="3" Height="28"
                                             Padding="8,5" Margin="0,8,0,0" Text="de-DE-Neural2-C"
                                             ToolTip="z.B. de-DE-Neural2-C, de-DE-Wavenet-C"/>
                                </Grid>

                                <!-- Test-Button -->
                                <StackPanel Orientation="Horizontal" Margin="0,12,0,0">
                                    <Button x:Name="TestGoogleTtsButton" Content="Verbindung testen"
                                            Width="130" Height="28"
                                            Click="TestGoogleTts_Click"
                                            Background="#4CAF50" Foreground="White"/>
                                    <TextBlock x:Name="GoogleTtsStatusText" Text=""
                                               VerticalAlignment="Center" Margin="10,0,0,0"
                                               Foreground="Gray"/>
                                </StackPanel>
                            </StackPanel>
                        </GroupBox>

                        <!-- Claude Audio (Platzhalter) -->
                        <GroupBox Header="Claude Audio" Padding="10" Margin="0,0,0,12" IsEnabled="False">
                            <StackPanel>
                                <Border Background="#F3E5F5" BorderBrush="#CE93D8" BorderThickness="1"
                                        CornerRadius="4" Padding="10">
                                    <TextBlock TextWrapping="Wrap" FontSize="12">
                                        Claude Audio/TTS ist noch nicht verfuegbar.
                                        Der API-Key kann spaeter fuer Text-Optimierung genutzt werden.
                                    </TextBlock>
                                </Border>
                                <Grid Margin="0,10,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="API-Key:" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                    <PasswordBox x:Name="ClaudeApiKeyBox" Grid.Column="1" Height="28" Padding="8,5"/>
                                </Grid>
                            </StackPanel>
                        </GroupBox>

                        <!-- Info Box -->
                        <Border Background="#E3F2FD" BorderBrush="#90CAF9" BorderThickness="1"
                                CornerRadius="4" Padding="10" Margin="0,10,0,0">
                            <TextBlock TextWrapping="Wrap" FontSize="12">
                                Du kannst zwischen verschiedenen TTS-Engines wechseln.
                                ElevenLabs-Einstellungen findest du im Tab "ElevenLabs".
                                Die gewaehlte Standard-Engine wird fuer alle Vertonungen verwendet.
                            </TextBlock>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- ElevenLabs Tab -->
            <TabItem Header="ElevenLabs">
                <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="10">
                    <StackPanel>
                        <TextBlock Text="ElevenLabs API Konfiguration"
                                   FontSize="16" FontWeight="Bold" Margin="0,0,0,15"/>

                        <!-- API Key -->
                        <StackPanel Margin="0,0,0,12">
                            <TextBlock Text="API-Key:" FontWeight="SemiBold" Margin="0,0,0,5"/>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <PasswordBox x:Name="ApiKeyBox" Grid.Column="0" Height="28" Padding="8,5"
                                             PasswordChanged="ApiKeyBox_PasswordChanged"/>
                                <TextBox x:Name="ApiKeyTextBox" Grid.Column="0" Height="28" Padding="8,5"
                                         Visibility="Collapsed" TextChanged="ApiKeyTextBox_TextChanged"/>
                                <Button Grid.Column="1" Content="Zeigen" Width="60" Margin="5,0,0,0"
                                        Click="ToggleApiKeyVisibility"/>
                            </Grid>
                            <TextBlock Text="elevenlabs.io → Profile → API Keys"
                                       Foreground="Gray" FontSize="11" Margin="0,3,0,0"/>
                        </StackPanel>

                        <!-- Voice ID (Legacy/Default) -->
                        <StackPanel Margin="0,0,0,12">
                            <TextBlock Text="Default Voice-ID:" FontWeight="SemiBold" Margin="0,0,0,5"/>
                            <TextBox x:Name="VoiceIdBox" Height="28" Padding="8,5"/>
                            <TextBlock Text="Wird verwendet wenn keine spezifische Stimme gewaehlt ist"
                                       Foreground="Gray" FontSize="11" Margin="0,3,0,0"/>
                        </StackPanel>

                        <!-- Männliche Voice-ID -->
                        <StackPanel Margin="0,0,0,12">
                            <TextBlock Text="Maennliche Voice-ID:" FontWeight="SemiBold" Margin="0,0,0,5"/>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBox x:Name="ElevenLabsMaleVoiceIdBox" Grid.Column="0" Height="28" Padding="8,5"/>
                                <Button Grid.Column="1" Content="Test" Width="50" Margin="5,0,0,0"
                                        Click="TestElevenLabsMaleVoice_Click"/>
                            </Grid>
                            <TextBlock Text="z.B. ErXwobaYiN019PkySvjV (Antoni)"
                                       Foreground="Gray" FontSize="11" Margin="0,3,0,0"/>
                        </StackPanel>

                        <!-- Weibliche Voice-ID -->
                        <StackPanel Margin="0,0,0,12">
                            <TextBlock Text="Weibliche Voice-ID:" FontWeight="SemiBold" Margin="0,0,0,5"/>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBox x:Name="ElevenLabsFemaleVoiceIdBox" Grid.Column="0" Height="28" Padding="8,5"/>
                                <Button Grid.Column="1" Content="Test" Width="50" Margin="5,0,0,0"
                                        Click="TestElevenLabsFemaleVoice_Click"/>
                            </Grid>
                            <TextBlock Text="z.B. EXAVITQu4vr4xnSDxMaL (Bella)"
                                       Foreground="Gray" FontSize="11" Margin="0,3,0,0"/>
                        </StackPanel>

                        <!-- Model ID -->
                        <StackPanel Margin="0,0,0,12">
                            <TextBlock Text="Model-ID:" FontWeight="SemiBold" Margin="0,0,0,5"/>
                            <ComboBox x:Name="ModelIdCombo" Height="28" SelectedIndex="0">
                                <ComboBoxItem Content="eleven_multilingual_v2" Tag="eleven_multilingual_v2"/>
                                <ComboBoxItem Content="eleven_turbo_v2_5" Tag="eleven_turbo_v2_5"/>
                                <ComboBoxItem Content="eleven_monolingual_v1" Tag="eleven_monolingual_v1"/>
                            </ComboBox>
                        </StackPanel>

                        <!-- Voice Settings -->
                        <GroupBox Header="Voice-Einstellungen" Padding="10" Margin="0,0,0,12">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0" Margin="0,0,10,0">
                                    <TextBlock Text="Stabilität:" Margin="0,0,0,3"/>
                                    <StackPanel Orientation="Horizontal">
                                        <Slider x:Name="StabilitySlider" Width="120" Minimum="0" Maximum="1"
                                                Value="0.5" TickFrequency="0.1" IsSnapToTickEnabled="True"/>
                                        <TextBlock Text="{Binding ElementName=StabilitySlider, Path=Value, StringFormat={}{0:F1}}"
                                                   Margin="5,0,0,0" Width="25"/>
                                    </StackPanel>
                                </StackPanel>

                                <StackPanel Grid.Column="1">
                                    <TextBlock Text="Similarity Boost:" Margin="0,0,0,3"/>
                                    <StackPanel Orientation="Horizontal">
                                        <Slider x:Name="SimilaritySlider" Width="120" Minimum="0" Maximum="1"
                                                Value="0.75" TickFrequency="0.1" IsSnapToTickEnabled="True"/>
                                        <TextBlock Text="{Binding ElementName=SimilaritySlider, Path=Value, StringFormat={}{0:F1}}"
                                                   Margin="5,0,0,0" Width="25"/>
                                    </StackPanel>
                                </StackPanel>
                            </Grid>
                        </GroupBox>

                        <!-- Test Button -->
                        <Button Content="ElevenLabs Verbindung testen" Height="30"
                                Click="TestElevenLabsConnection_Click" HorizontalAlignment="Left" Width="200"/>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Kosten-Tracking Tab -->
            <TabItem Header="Kosten">
                <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="10">
                    <StackPanel>
                        <TextBlock Text="Kosten- &amp; Token-Tracking"
                                   FontSize="16" FontWeight="Bold" Margin="0,0,0,15"/>

                        <!-- Info Box -->
                        <Border Background="#E3F2FD" BorderBrush="#90CAF9" BorderThickness="1"
                                CornerRadius="4" Padding="10" Margin="0,0,0,15">
                            <TextBlock TextWrapping="Wrap" FontSize="12">
                                Diese Einstellungen werden für die Kostenschätzung vor Batch-Generierungen
                                und das Session-Tracking verwendet. Passe die Werte an deinen API-Tarif an.
                            </TextBlock>
                        </Border>

                        <!-- Zeichen pro Token -->
                        <StackPanel Margin="0,0,0,12">
                            <TextBlock Text="Ø Zeichen pro Token:" FontWeight="SemiBold" Margin="0,0,0,5"/>
                            <StackPanel Orientation="Horizontal">
                                <TextBox x:Name="AvgCharsPerTokenBox" Width="100" Height="28" Padding="8,5" Text="4.0"
                                         TextChanged="CostParameter_TextChanged"/>
                                <TextBlock Text="Standard: 4.0 (deutsch ~3.5, englisch ~4.5)"
                                           Foreground="Gray" FontSize="11" VerticalAlignment="Center" Margin="10,0,0,0"/>
                            </StackPanel>
                        </StackPanel>

                        <!-- Kosten pro 1000 Tokens -->
                        <StackPanel Margin="0,0,0,12">
                            <TextBlock Text="Kosten pro 1.000 Tokens:" FontWeight="SemiBold" Margin="0,0,0,5"/>
                            <StackPanel Orientation="Horizontal">
                                <TextBox x:Name="CostPer1kTokensBox" Width="100" Height="28" Padding="8,5" Text="0.30"
                                         TextChanged="CostParameter_TextChanged"/>
                                <TextBlock Text="z.B. 0.30 für ElevenLabs Standard"
                                           Foreground="Gray" FontSize="11" VerticalAlignment="Center" Margin="10,0,0,0"/>
                            </StackPanel>
                        </StackPanel>

                        <!-- Währungssymbol -->
                        <StackPanel Margin="0,0,0,12">
                            <TextBlock Text="Währungssymbol:" FontWeight="SemiBold" Margin="0,0,0,5"/>
                            <StackPanel Orientation="Horizontal">
                                <TextBox x:Name="CurrencySymbolBox" Width="60" Height="28" Padding="8,5" Text="€"
                                         TextChanged="CostParameter_TextChanged"/>
                                <TextBlock Text="z.B. €, $, CHF"
                                           Foreground="Gray" FontSize="11" VerticalAlignment="Center" Margin="10,0,0,0"/>
                            </StackPanel>
                        </StackPanel>

                        <!-- Beispielrechnung -->
                        <GroupBox Header="Beispielrechnung" Padding="10" Margin="0,15,0,0">
                            <StackPanel>
                                <TextBlock x:Name="CostExampleText" TextWrapping="Wrap" FontSize="12">
                                    10.000 Zeichen × 2 Stimmen = 20.000 effektive Zeichen
                                    &#x0a;÷ 4.0 Zeichen/Token = 5.000 Tokens
                                    &#x0a;× 0.30 € / 1.000 Tokens = 1,50 €
                                </TextBlock>
                            </StackPanel>
                        </GroupBox>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Stimmen Tab -->
            <TabItem Header="Stimmen">
                <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="10">
                    <StackPanel>
                        <TextBlock Text="Stimmen-Konfiguration"
                                   FontSize="16" FontWeight="Bold" Margin="0,0,0,15"/>

                        <!-- Info Box -->
                        <Border Background="#E3F2FD" BorderBrush="#90CAF9" BorderThickness="1"
                                CornerRadius="4" Padding="10" Margin="0,0,0,15">
                            <TextBlock TextWrapping="Wrap" FontSize="12">
                                Hier kannst du die Stimmen für die TTS-Generierung konfigurieren.
                                Die Voice-IDs findest du in deinem ElevenLabs Dashboard unter "Voices".
                            </TextBlock>
                        </Border>

                        <!-- Männliche Erzähler-Stimme -->
                        <GroupBox Header="Männliche Erzähler-Stimme" Padding="10" Margin="0,0,0,12">
                            <StackPanel>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Voice-ID:" VerticalAlignment="Center" Margin="0,0,10,8"/>
                                    <TextBox x:Name="MaleVoiceIdBox" Grid.Row="0" Grid.Column="1" Height="28" Padding="8,5" Margin="0,0,0,8"/>

                                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Name:" VerticalAlignment="Center" Margin="0,0,10,8"/>
                                    <TextBox x:Name="MaleVoiceNameBox" Grid.Row="1" Grid.Column="1" Height="28" Padding="8,5" Margin="0,0,0,8"
                                             Text="Male Narrator"/>

                                    <TextBlock Grid.Row="2" Grid.Column="0" Text="Beschreibung:" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                    <TextBox x:Name="MaleVoiceDescBox" Grid.Row="2" Grid.Column="1" Height="28" Padding="8,5"/>
                                </Grid>
                            </StackPanel>
                        </GroupBox>

                        <!-- Weibliche Erzähler-Stimme -->
                        <GroupBox Header="Weibliche Erzähler-Stimme" Padding="10" Margin="0,0,0,12">
                            <StackPanel>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Voice-ID:" VerticalAlignment="Center" Margin="0,0,10,8"/>
                                    <TextBox x:Name="FemaleVoiceIdBox" Grid.Row="0" Grid.Column="1" Height="28" Padding="8,5" Margin="0,0,0,8"/>

                                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Name:" VerticalAlignment="Center" Margin="0,0,10,8"/>
                                    <TextBox x:Name="FemaleVoiceNameBox" Grid.Row="1" Grid.Column="1" Height="28" Padding="8,5" Margin="0,0,0,8"
                                             Text="Female Narrator"/>

                                    <TextBlock Grid.Row="2" Grid.Column="0" Text="Beschreibung:" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                    <TextBox x:Name="FemaleVoiceDescBox" Grid.Row="2" Grid.Column="1" Height="28" Padding="8,5"/>
                                </Grid>
                            </StackPanel>
                        </GroupBox>

                        <!-- Vorschau / Test -->
                        <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                            <Button Content="Männliche Stimme testen" Height="30" Width="160" Margin="0,0,10,0"
                                    Click="TestMaleVoice_Click"/>
                            <Button Content="Weibliche Stimme testen" Height="30" Width="160"
                                    Click="TestFemaleVoice_Click"/>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- LLM Tab -->
            <TabItem Header="LLM (Text-KI)">
                <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="10">
                    <StackPanel>
                        <TextBlock Text="LLM Text-Optimierung"
                                   FontSize="16" FontWeight="Bold" Margin="0,0,0,15"/>

                        <!-- Info Box -->
                        <Border Background="#F3E5F5" BorderBrush="#CE93D8" BorderThickness="1"
                                CornerRadius="4" Padding="10" Margin="0,0,0,15">
                            <TextBlock TextWrapping="Wrap" FontSize="12">
                                Nutze KI-Modelle (ChatGPT, Claude, Gemini) um Quest-Texte in
                                hoerbuchreife Erzaehlungen umzuwandeln. Die "Text glaetten"-Funktion
                                im Hauptfenster verwendet diese Einstellungen.
                            </TextBlock>
                        </Border>

                        <!-- Provider Auswahl -->
                        <StackPanel Margin="0,0,0,12">
                            <TextBlock Text="LLM-Provider:" FontWeight="SemiBold" Margin="0,0,0,5"/>
                            <ComboBox x:Name="LlmProviderCombo" Height="28" SelectedIndex="0"
                                      SelectionChanged="LlmProviderCombo_SelectionChanged">
                                <ComboBoxItem Content="OpenAI (ChatGPT)" Tag="OpenAI"/>
                                <ComboBoxItem Content="Anthropic (Claude)" Tag="Anthropic"/>
                                <ComboBoxItem Content="Google (Gemini)" Tag="Google"/>
                            </ComboBox>
                        </StackPanel>

                        <!-- API Key -->
                        <StackPanel Margin="0,0,0,12">
                            <TextBlock Text="API-Key:" FontWeight="SemiBold" Margin="0,0,0,5"/>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <PasswordBox x:Name="LlmApiKeyBox" Grid.Column="0" Height="28" Padding="8,5"
                                             PasswordChanged="LlmApiKeyBox_PasswordChanged"/>
                                <TextBox x:Name="LlmApiKeyTextBox" Grid.Column="0" Height="28" Padding="8,5"
                                         Visibility="Collapsed" TextChanged="LlmApiKeyTextBox_TextChanged"/>
                                <Button Grid.Column="1" Content="Zeigen" Width="60" Margin="5,0,0,0"
                                        Click="ToggleLlmApiKeyVisibility"/>
                            </Grid>
                            <TextBlock x:Name="LlmApiKeyHint" Text="platform.openai.com → API Keys"
                                       Foreground="Gray" FontSize="11" Margin="0,3,0,0"/>
                        </StackPanel>

                        <!-- Model ID -->
                        <StackPanel Margin="0,0,0,12">
                            <TextBlock Text="Model-ID:" FontWeight="SemiBold" Margin="0,0,0,5"/>
                            <ComboBox x:Name="LlmModelCombo" Height="28" IsEditable="True"/>
                            <TextBlock Text="Kleinere Modelle sind guenstiger, groessere meist besser"
                                       Foreground="Gray" FontSize="11" Margin="0,3,0,0"/>
                        </StackPanel>

                        <!-- Erweiterte Einstellungen -->
                        <Expander Header="Erweiterte Einstellungen" Margin="0,5,0,12">
                            <StackPanel Margin="0,10,0,0">
                                <!-- Temperature -->
                                <StackPanel Margin="0,0,0,12">
                                    <TextBlock Text="Temperatur (Kreativitaet):" Margin="0,0,0,3"/>
                                    <StackPanel Orientation="Horizontal">
                                        <Slider x:Name="LlmTemperatureSlider" Width="200" Minimum="0" Maximum="1"
                                                Value="0.7" TickFrequency="0.1" IsSnapToTickEnabled="True"/>
                                        <TextBlock Text="{Binding ElementName=LlmTemperatureSlider, Path=Value, StringFormat={}{0:F1}}"
                                                   Margin="10,0,0,0" Width="25" VerticalAlignment="Center"/>
                                    </StackPanel>
                                    <TextBlock Text="0.0 = deterministisch, 1.0 = sehr kreativ"
                                               Foreground="Gray" FontSize="11" Margin="0,3,0,0"/>
                                </StackPanel>

                                <!-- Max Tokens -->
                                <StackPanel Margin="0,0,0,12">
                                    <TextBlock Text="Max. Output-Tokens:" Margin="0,0,0,3"/>
                                    <StackPanel Orientation="Horizontal">
                                        <TextBox x:Name="LlmMaxTokensBox" Width="100" Height="28" Padding="8,5" Text="1024"/>
                                        <TextBlock Text="Maximale Laenge der Antwort"
                                                   Foreground="Gray" FontSize="11" VerticalAlignment="Center" Margin="10,0,0,0"/>
                                    </StackPanel>
                                </StackPanel>

                                <!-- Auto-Enhance -->
                                <CheckBox x:Name="LlmAutoEnhanceCheckBox" Margin="0,0,0,12"
                                          Content="Automatisch bei TTS-Generierung optimieren"
                                          ToolTip="Wenn aktiviert, wird der Text vor jeder TTS-Generierung automatisch optimiert"/>

                                <!-- Custom System Prompt -->
                                <StackPanel Margin="0,0,0,8">
                                    <TextBlock Text="Benutzerdefinierter System-Prompt (optional):" Margin="0,0,0,5"/>
                                    <TextBox x:Name="LlmSystemPromptBox" Height="80" TextWrapping="Wrap"
                                             AcceptsReturn="True" VerticalScrollBarVisibility="Auto"
                                             Padding="8,5"/>
                                    <TextBlock Text="Leer lassen fuer Standard-Hoerbuch-Prompt"
                                               Foreground="Gray" FontSize="11" Margin="0,3,0,0"/>
                                </StackPanel>
                            </StackPanel>
                        </Expander>

                        <!-- Test Button -->
                        <Button Content="LLM Verbindung testen" Height="30"
                                Click="TestLlmConnection_Click" HorizontalAlignment="Left" Width="200"/>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- SQLite Datenbank Tab -->
            <TabItem Header="Quest-Datenbank">
                <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="10">
                    <StackPanel>
                        <TextBlock Text="Quest-Datenbank (SQLite)"
                                   FontSize="16" FontWeight="Bold" Margin="0,0,0,15"/>

                        <!-- Info Box -->
                        <Border Background="#E8F5E9" BorderBrush="#A5D6A7" BorderThickness="1"
                                CornerRadius="4" Padding="10" Margin="0,0,0,15">
                            <TextBlock TextWrapping="Wrap" FontSize="12">
                                Verwende eine lokale SQLite-Datenbank für Quests anstelle der Blizzard API.
                                Die Datenbank kannst du mit dem WowQuestExporter-Tool aus deiner MySQL-Datenbank erstellen.
                            </TextBlock>
                        </Border>

                        <!-- SQLite aktivieren -->
                        <CheckBox x:Name="UseSqliteCheckBox" Margin="0,0,0,15"
                                  Content="SQLite-Datenbank verwenden (statt Blizzard API)"
                                  Checked="UseSqliteCheckBox_Changed" Unchecked="UseSqliteCheckBox_Changed"/>

                        <!-- Datenbankpfad -->
                        <StackPanel x:Name="SqlitePathPanel" Margin="0,0,0,12">
                            <TextBlock Text="SQLite-Datenbankpfad:" FontWeight="SemiBold" Margin="0,0,0,5"/>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBox x:Name="SqlitePathBox" Grid.Column="0" Height="28" Padding="8,5"
                                         IsReadOnly="True"/>
                                <Button Grid.Column="1" Content="..." Width="40" Margin="5,0,0,0"
                                        Click="BrowseSqlitePath_Click"/>
                            </Grid>
                            <TextBlock Text="Pfad zur quests_deDE.db Datei"
                                       Foreground="Gray" FontSize="11" Margin="0,3,0,0"/>
                        </StackPanel>

                        <!-- Statistik -->
                        <GroupBox Header="Datenbank-Info" Padding="10" Margin="0,10,0,12"
                                  x:Name="SqliteStatsGroup">
                            <StackPanel>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Status:" Margin="0,0,10,5"/>
                                    <TextBlock x:Name="SqliteStatusText" Grid.Row="0" Grid.Column="1"
                                               Text="Nicht konfiguriert" Margin="0,0,0,5"/>

                                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Quests:" Margin="0,0,10,5"/>
                                    <TextBlock x:Name="SqliteQuestCountText" Grid.Row="1" Grid.Column="1"
                                               Text="-" Margin="0,0,0,5"/>

                                    <TextBlock Grid.Row="2" Grid.Column="0" Text="Zonen:" Margin="0,0,10,0"/>
                                    <TextBlock x:Name="SqliteZoneCountText" Grid.Row="2" Grid.Column="1" Text="-"/>
                                </Grid>
                            </StackPanel>
                        </GroupBox>

                        <!-- Test Button -->
                        <Button Content="SQLite Verbindung testen" Height="30"
                                Click="TestSqliteConnection_Click" HorizontalAlignment="Left" Width="200"/>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Blizzard API Tab -->
            <TabItem Header="Blizzard API">
                <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="10">
                    <StackPanel>
                        <TextBlock Text="Blizzard API Konfiguration"
                                   FontSize="16" FontWeight="Bold" Margin="0,0,0,15"/>

                        <!-- Client ID -->
                        <StackPanel Margin="0,0,0,12">
                            <TextBlock Text="Client-ID:" FontWeight="SemiBold" Margin="0,0,0,5"/>
                            <TextBox x:Name="BlizzardClientIdBox" Height="28" Padding="8,5"/>
                            <TextBlock Text="develop.battle.net → Anwendungen → Client-ID"
                                       Foreground="Gray" FontSize="11" Margin="0,3,0,0"/>
                        </StackPanel>

                        <!-- Client Secret -->
                        <StackPanel Margin="0,0,0,12">
                            <TextBlock Text="Client-Secret:" FontWeight="SemiBold" Margin="0,0,0,5"/>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <PasswordBox x:Name="BlizzardSecretBox" Grid.Column="0" Height="28" Padding="8,5"
                                             PasswordChanged="BlizzardSecretBox_PasswordChanged"/>
                                <TextBox x:Name="BlizzardSecretTextBox" Grid.Column="0" Height="28" Padding="8,5"
                                         Visibility="Collapsed" TextChanged="BlizzardSecretTextBox_TextChanged"/>
                                <Button Grid.Column="1" Content="Zeigen" Width="60" Margin="5,0,0,0"
                                        Click="ToggleBlizzardSecretVisibility"/>
                            </Grid>
                        </StackPanel>

                        <!-- Region -->
                        <StackPanel Margin="0,0,0,12">
                            <TextBlock Text="Region:" FontWeight="SemiBold" Margin="0,0,0,5"/>
                            <ComboBox x:Name="BlizzardRegionCombo" Height="28" SelectedIndex="0">
                                <ComboBoxItem Content="EU (Europa)" Tag="eu"/>
                                <ComboBoxItem Content="US (Amerika)" Tag="us"/>
                                <ComboBoxItem Content="KR (Korea)" Tag="kr"/>
                                <ComboBoxItem Content="TW (Taiwan)" Tag="tw"/>
                            </ComboBox>
                        </StackPanel>

                        <!-- Max Quests -->
                        <StackPanel Margin="0,0,0,12">
                            <TextBlock Text="Max. Quests:" FontWeight="SemiBold" Margin="0,0,0,5"/>
                            <StackPanel Orientation="Horizontal">
                                <TextBox x:Name="MaxQuestsBox" Width="100" Height="28" Padding="8,5" Text="1000"/>
                                <TextBlock Text="Maximale Anzahl zu ladender Quests"
                                           Foreground="Gray" FontSize="11" VerticalAlignment="Center" Margin="10,0,0,0"/>
                            </StackPanel>
                        </StackPanel>

                        <!-- Info Box -->
                        <Border Background="#E3F2FD" BorderBrush="#90CAF9" BorderThickness="1"
                                CornerRadius="4" Padding="10" Margin="0,10,0,12">
                            <StackPanel>
                                <TextBlock Text="So erhältst du deine Zugangsdaten:" FontWeight="SemiBold" Margin="0,0,0,5"/>
                                <TextBlock TextWrapping="Wrap" FontSize="12">
                                    1. Gehe zu develop.battle.net&#x0a;
                                    2. Melde dich mit deinem Battle.net-Account an&#x0a;
                                    3. Klicke auf "Anwendung erstellen"&#x0a;
                                    4. Kopiere Client-ID und Client-Secret
                                </TextBlock>
                            </StackPanel>
                        </Border>

                        <!-- Test Button -->
                        <Button Content="Blizzard Verbindung testen" Height="30"
                                Click="TestBlizzardConnection_Click" HorizontalAlignment="Left" Width="200"/>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
        </TabControl>

        <!-- Status -->
        <Border Grid.Row="1" Background="#FFF3CD" BorderBrush="#FFEEBA" BorderThickness="1"
                CornerRadius="4" Padding="10" Margin="0,10,0,0" x:Name="StatusBorder">
            <TextBlock x:Name="StatusText" Text="Konfiguriere deine API-Zugangsdaten."
                       TextWrapping="Wrap"/>
        </Border>

        <!-- Buttons -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,15,0,0">
            <Button Content="Speichern" Width="100" Height="30" Margin="0,0,10,0"
                    Click="Save_Click" IsDefault="True"/>
            <Button Content="Abbrechen" Width="100" Height="30"
                    Click="Cancel_Click" IsCancel="True"/>
        </StackPanel>
    </Grid>
</Window>
