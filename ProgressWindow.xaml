<Window x:Class="WowQuestTtsTool.ProgressWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:WowQuestTtsTool"
        Title="Vertonungs-Fortschritt nach Gebiet"
        Width="900"
        Height="650"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResize">

    <Window.Resources>
        <!-- Style fuer Progress-Bar mit Prozentanzeige -->
        <Style x:Key="ProgressBarWithText" TargetType="ProgressBar">
            <Setter Property="Height" Value="20"/>
            <Setter Property="Minimum" Value="0"/>
            <Setter Property="Maximum" Value="100"/>
        </Style>
    </Window.Resources>

    <Grid Margin="12">
        <Grid.RowDefinitions>
            <!-- Header / Statistik-Uebersicht -->
            <RowDefinition Height="Auto"/>
            <!-- Haupt-DataGrid: Zonen-Uebersicht -->
            <RowDefinition Height="2*"/>
            <!-- Splitter -->
            <RowDefinition Height="Auto"/>
            <!-- Detail-Liste: Fehlende Quests in ausgewaehlter Zone -->
            <RowDefinition Height="*"/>
            <!-- Footer / Buttons -->
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- ==================== HEADER: Gesamtstatistik ==================== -->
        <Border Grid.Row="0" Background="#E3F2FD" BorderBrush="#90CAF9" BorderThickness="1"
                CornerRadius="4" Padding="12" Margin="0,0,0,8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Gesamt-Quests -->
                <StackPanel Grid.Column="0" HorizontalAlignment="Center">
                    <TextBlock Text="Quests gesamt" FontWeight="SemiBold" HorizontalAlignment="Center"/>
                    <TextBlock x:Name="TotalQuestsText" Text="0" FontSize="24" FontWeight="Bold"
                               Foreground="#1976D2" HorizontalAlignment="Center"/>
                </StackPanel>

                <!-- Vertont -->
                <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                    <TextBlock Text="Vertont" FontWeight="SemiBold" HorizontalAlignment="Center"/>
                    <TextBlock x:Name="VoicedQuestsText" Text="0" FontSize="24" FontWeight="Bold"
                               Foreground="#4CAF50" HorizontalAlignment="Center"/>
                </StackPanel>

                <!-- Fehlend -->
                <StackPanel Grid.Column="2" HorizontalAlignment="Center">
                    <TextBlock Text="Fehlend" FontWeight="SemiBold" HorizontalAlignment="Center"/>
                    <TextBlock x:Name="MissingQuestsText" Text="0" FontSize="24" FontWeight="Bold"
                               Foreground="#F44336" HorizontalAlignment="Center"/>
                </StackPanel>

                <!-- Problem-Quests -->
                <StackPanel Grid.Column="3" HorizontalAlignment="Center">
                    <TextBlock Text="Probleme" FontWeight="SemiBold" HorizontalAlignment="Center"
                               ToolTip="Quests mit unvollstaendiger oder gemischter Lokalisierung"/>
                    <TextBlock x:Name="ProblemQuestsText" Text="0" FontSize="24" FontWeight="Bold"
                               Foreground="#FF9800" HorizontalAlignment="Center"/>
                </StackPanel>

                <!-- Fortschritt -->
                <StackPanel Grid.Column="4" HorizontalAlignment="Center">
                    <TextBlock Text="Fortschritt" FontWeight="SemiBold" HorizontalAlignment="Center"/>
                    <TextBlock x:Name="TotalProgressText" Text="0%" FontSize="24" FontWeight="Bold"
                               Foreground="#673AB7" HorizontalAlignment="Center"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- ==================== HAUPT-DATAGRID: Zonen-Uebersicht ==================== -->
        <GroupBox Grid.Row="1" Header="Fortschritt pro Zone/Gebiet" Margin="0,0,0,4">
            <DataGrid x:Name="ZoneProgressDataGrid"
                      AutoGenerateColumns="False"
                      IsReadOnly="True"
                      CanUserAddRows="False"
                      CanUserDeleteRows="False"
                      SelectionMode="Single"
                      SelectionChanged="ZoneProgressDataGrid_SelectionChanged"
                      GridLinesVisibility="Horizontal"
                      AlternatingRowBackground="#F5F5F5"
                      RowHeight="26">
                <DataGrid.Columns>
                    <!-- Zone Name -->
                    <DataGridTextColumn Header="Zone / Gebiet" Binding="{Binding ZoneName}" Width="*" MinWidth="150">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="FontWeight" Value="SemiBold"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                                <Setter Property="Padding" Value="4,0"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>

                    <!-- Gesamt -->
                    <DataGridTextColumn Header="Gesamt" Binding="{Binding TotalQuests}" Width="70">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="HorizontalAlignment" Value="Center"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>

                    <!-- Vertont -->
                    <DataGridTextColumn Header="Vertont" Binding="{Binding VoicedQuests}" Width="70">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="HorizontalAlignment" Value="Center"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                                <Setter Property="Foreground" Value="#4CAF50"/>
                                <Setter Property="FontWeight" Value="SemiBold"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>

                    <!-- Fehlend -->
                    <DataGridTextColumn Header="Fehlend" Binding="{Binding MissingQuests}" Width="70">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="HorizontalAlignment" Value="Center"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                                <Setter Property="Foreground" Value="#F44336"/>
                                <Setter Property="FontWeight" Value="SemiBold"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>

                    <!-- Problem-Quests -->
                    <DataGridTextColumn Header="Probleme" Binding="{Binding ProblemQuests}" Width="65"
                                        ToolTipService.ToolTip="Quests mit gemischter oder unvollstaendiger Lokalisierung">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="HorizontalAlignment" Value="Center"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                                <Setter Property="Foreground" Value="#FF9800"/>
                                <Setter Property="FontWeight" Value="SemiBold"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding HasProblems}" Value="False">
                                        <Setter Property="Foreground" Value="#9E9E9E"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>

                    <!-- Fortschritt Prozent -->
                    <DataGridTextColumn Header="%" Binding="{Binding ProgressPercent, StringFormat={}{0:F0}%}" Width="50">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="HorizontalAlignment" Value="Center"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                                <Setter Property="FontWeight" Value="Bold"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>

                    <!-- Fortschrittsbalken mit farblicher Codierung via ProgressColorBrush -->
                    <DataGridTemplateColumn Header="Fortschritt" Width="150" MinWidth="100">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Grid Margin="4,2">
                                    <!-- Fortschrittsbalken mit dynamischer Farbe basierend auf Prozent:
                                         Rot (0-25%), Orange (25-50%), Gelb (50-75%), Gruen (75-100%) -->
                                    <ProgressBar Value="{Binding ProgressPercent, Mode=OneWay}"
                                                 Minimum="0" Maximum="100" Height="16"
                                                 Foreground="{Binding ProgressColorBrush, Mode=OneWay}"/>
                                    <TextBlock Text="{Binding ProgressPercent, StringFormat={}{0:F0}%}"
                                               HorizontalAlignment="Center" VerticalAlignment="Center"
                                               FontSize="10" FontWeight="Bold"
                                               Foreground="White">
                                        <TextBlock.Effect>
                                            <DropShadowEffect ShadowDepth="1" Color="Black" BlurRadius="2" Opacity="0.5"/>
                                        </TextBlock.Effect>
                                    </TextBlock>
                                </Grid>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <!-- Komplett-Status -->
                    <DataGridTemplateColumn Header="Status" Width="60">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock HorizontalAlignment="Center" VerticalAlignment="Center" FontSize="14">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Text" Value="..."/>
                                            <Setter Property="Foreground" Value="Gray"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsComplete}" Value="True">
                                                    <Setter Property="Text" Value="OK"/>
                                                    <Setter Property="Foreground" Value="#4CAF50"/>
                                                    <Setter Property="FontWeight" Value="Bold"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </GroupBox>

        <!-- ==================== SPLITTER ==================== -->
        <GridSplitter Grid.Row="2" Height="5" HorizontalAlignment="Stretch"
                      Background="#CCCCCC" Margin="0,2"/>

        <!-- ==================== DETAIL-LISTE: Fehlende Quests ==================== -->
        <GroupBox Grid.Row="3" Margin="0,4,0,4">
            <GroupBox.Header>
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="Quests in: " FontWeight="SemiBold"/>
                    <TextBlock x:Name="SelectedZoneText" Text="(Keine Zone ausgewaehlt)"
                               FontWeight="Bold" Foreground="#1976D2" Margin="0,0,16,0"/>
                    <!-- Filter-RadioButtons fuer Detailansicht -->
                    <TextBlock Text="| Filter:" FontWeight="SemiBold" Margin="0,0,8,0" Foreground="Gray"/>
                    <RadioButton x:Name="FilterMissingRadio" Content="Fehlende" GroupName="DetailFilter"
                                 IsChecked="True" Margin="0,0,8,0" VerticalAlignment="Center"
                                 Checked="OnFilterMissingChecked"
                                 ToolTip="Zeigt nur Quests ohne vollstaendige TTS-Vertonung"/>
                    <RadioButton x:Name="FilterProblemsRadio" Content="Probleme" GroupName="DetailFilter"
                                 Margin="0,0,8,0" VerticalAlignment="Center"
                                 Checked="OnFilterProblemsChecked"
                                 ToolTip="Zeigt nur Quests mit Lokalisierungsproblemen (DE/EN gemischt oder unvollstaendig)"/>
                    <RadioButton x:Name="FilterBothRadio" Content="Fehlend+Probleme" GroupName="DetailFilter"
                                 Margin="0,0,8,0" VerticalAlignment="Center"
                                 Checked="OnFilterBothChecked"
                                 ToolTip="Zeigt fehlende UND problematische Quests"/>
                    <RadioButton x:Name="FilterAllRadio" Content="Alle" GroupName="DetailFilter"
                                 VerticalAlignment="Center"
                                 Checked="OnFilterAllChecked"
                                 ToolTip="Zeigt alle Quests der Zone"/>
                </StackPanel>
            </GroupBox.Header>
            <DataGrid x:Name="MissingQuestsDataGrid"
                      AutoGenerateColumns="False"
                      IsReadOnly="True"
                      CanUserAddRows="False"
                      CanUserDeleteRows="False"
                      SelectionMode="Single"
                      GridLinesVisibility="Horizontal"
                      AlternatingRowBackground="#FFF8E1"
                      RowHeight="24">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="ID" Binding="{Binding QuestId}" Width="60"/>
                    <DataGridTextColumn Header="Kategorie" Binding="{Binding CategoryShortName}" Width="60"/>
                    <DataGridTextColumn Header="Titel" Binding="{Binding Title}" Width="*" MinWidth="200"/>
                    <DataGridCheckBoxColumn Header="Main" Binding="{Binding IsMainStory}" Width="45"/>
                    <DataGridCheckBoxColumn Header="Grp" Binding="{Binding IsGroupQuest}" Width="40"/>
                    <DataGridTextColumn Header="Spr" Binding="{Binding LocalizationStatusShortName}" Width="50"/>
                    <DataGridCheckBoxColumn Header="M" Binding="{Binding HasMaleTts}" Width="30" IsReadOnly="True"/>
                    <DataGridCheckBoxColumn Header="W" Binding="{Binding HasFemaleTts}" Width="30" IsReadOnly="True"/>
                </DataGrid.Columns>
            </DataGrid>
        </GroupBox>

        <!-- ==================== FOOTER: Buttons ==================== -->
        <StackPanel Grid.Row="4" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,8,0,0">
            <!-- Aktualisieren Button -->
            <Button x:Name="RefreshButton"
                    Content="Aktualisieren"
                    Width="100"
                    Height="30"
                    Margin="0,0,8,0"
                    Click="OnRefreshClick"
                    Background="#2196F3"
                    Foreground="White"
                    FontWeight="SemiBold"
                    ToolTip="Fortschrittsdaten neu laden"/>

            <!-- Zone in Hauptfenster laden -->
            <Button x:Name="LoadZoneInMainButton"
                    Content="Zone im Hauptfenster laden"
                    Width="180"
                    Height="30"
                    Margin="0,0,8,0"
                    Click="OnLoadZoneInMainClick"
                    Background="#FF9800"
                    Foreground="White"
                    FontWeight="SemiBold"
                    ToolTip="Laedt die ausgewaehlte Zone im Hauptfenster zum Vertonen"/>

            <!-- Schliessen Button -->
            <Button Content="Schliessen"
                    Width="80"
                    Height="30"
                    Click="OnCloseClick"
                    IsCancel="True"/>
        </StackPanel>
    </Grid>
</Window>
